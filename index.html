<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <script>

      $(document).ready(function(){

        // Initialize variables
        var lastLength = 0;
        var refresh = 1;

        // Create html structure/elements
        var $body = $('body');
        $body.html('');

        var $header = $('<header></header>').addClass('header');
        $body.append($header);

        var $tweetSection = $('<section></section>').addClass('tweetSection');
        $body.append($tweetSection);

        var $toggleRefresh = $('<div></div>').addClass('toggleRefresh').text('On');
        $header.append($toggleRefresh);

        // Button handler
        $toggleRefresh.on('click', function() {
          if(refresh === 1) {
            refresh = 0;
            $toggleRefresh.text('Off');
            $toggleRefresh.addClass('off');
          } else {
            refresh = 1;
            $toggleRefresh.text('On');
            $toggleRefresh.removeClass('off');
          }
        });

        // Check for new tweets, add new tweets to html
        var checkForNew = function() {

          var newLength = streams.home.length;
          var diff = newLength - lastLength;

          if(diff && refresh ===1) {
            for(var i=diff;i>=1;i--) {
              tweet = streams.home[newLength-i];
              var $tweet = $('<div></div>').addClass('tweet');
              var $tweetContainer = $('<div></div>').addClass('tweetContainer');  
              var $at = $('<div></div>').addClass('at').text('@').addClass('flex-center-vertically');
              var $user = $('<div></div>').addClass('user').text(tweet.user).addClass('flex-center-vertically');
              $tweet.text(tweet.message+' '+tweet.created_at).addClass('flex-center-vertically');

              $tweetContainer.addClass('clearfix');
              $tweetContainer.append($at).append($user).append($tweet);
              $tweetContainer.hide().prependTo($tweetSection).fadeIn(800);

              lastLength = streams.home.length;
            }
          }
        }

        // Set interval for checking of new tweets to 2000ms
        setInterval(checkForNew,2000);

      });

    </script>
  </body>
</html>
